# 🏗️ YOUTHY AI 시스템 아키텍처 (ASCII)

## 📊 전체 시스템 구조도

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              사용자 (User)                              │
└─────────────────┬───────────────────────────────────┬──────────────────┘
                  ▼                                   ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         Frontend Layer (웹 UI)                          │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌────────────┐ │
│  │  Chat UI     │  │  Policy      │  │  Swagger     │  │  TOP 10    │ │
│  │  채팅 인터페이스  │  │  Search UI   │  │  Docs UI     │  │  Rankings  │ │
│  └──────────────┘  └──────────────┘  └──────────────┘  └────────────┘ │
└────────┬──────────────────┬──────────────────┬────────────────┬────────┘
         ▼                  ▼                  ▼                ▼
    HTTP/HTTPS         HTTP/HTTPS         HTTP/HTTPS       HTTP/HTTPS
         ▼                  ▼                  ▼                ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         API Gateway Layer                               │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────┐  ┌─────────────────────────────────┐ │
│  │  Chatbot Server (:3000)      │  │  District API Server (:3001)    │ │
│  ├──────────────────────────────┤  ├─────────────────────────────────┤ │
│  │ • POST /api/chat             │  │ • GET /api/district-policies    │ │
│  │ • GET /api/popular-policies  │  │ • GET /api/special-top10        │ │
│  │ • GET /api/health            │  │ • GET /api/popular-keywords     │ │
│  └──────────────────────────────┘  └─────────────────────────────────┘ │
└────────┬──────────────────────────────────┬─────────────────────────────┘
         ▼                                  ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          Service Layer                                  │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐          │
│  │ YouthPolicy     │ │ DistrictPolicy  │ │ PopularPolicy   │          │
│  │ Service         │ │ Service         │ │ Service         │          │
│  ├─────────────────┤ ├─────────────────┤ ├─────────────────┤          │
│  │ • 정책 추천      │ │ • 구별 정책 조회  │ │ • TOP 10 분석   │          │
│  │ • 자연어 분석    │ │ • 날짜 계산      │ │ • 조회수 정렬    │          │
│  │ • 카테고리 매핑  │ │ • 필터링         │ │ • 트렌드 분석    │          │
│  └─────────────────┘ └─────────────────┘ └─────────────────┘          │
└────────┬──────────────────────────────────┬─────────────────────────────┘
         ▼                                  ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                      Data Processing Layer                              │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                    Real Policy Fetcher                           │  │
│  ├──────────────────────────────────────────────────────────────────┤  │
│  │ • GET 메서드 사용 (POST → GET 변경)                                │  │
│  │ • result.youthPolicyList 파싱                                    │  │
│  │ • 에러 핸들링 및 재시도                                            │  │
│  └────────────────────┬─────────────────────────────────────────────┘  │
│                       ▼                                                 │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                    Data Transformer                              │  │
│  ├──────────────────────────────────────────────────────────────────┤  │
│  │ • plcyExplnCn → description (정책설명내용 사용)                    │  │
│  │ • YYYYMMDD → ~MM/DD 변환 (날짜 포맷팅)                           │  │
│  │ • 'ㅇ' 마커 제거 (cleanDescription)                              │  │
│  │ • 카테고리 코드 → 한글 변환                                       │  │
│  └────────────────────┬─────────────────────────────────────────────┘  │
│                       ▼                                                 │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                    Cache Manager                                 │  │
│  ├──────────────────────────────────────────────────────────────────┤  │
│  │ • 5분 TTL (Time To Live)                                        │  │
│  │ • In-memory 캐싱                                                 │  │
│  │ • 구별 키 관리                                                    │  │
│  └──────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────┬───────────────┬───────────────────────────┘
                             ▼               ▼
                    ┌────────────────┐ ┌────────────────┐
                    │  External API  │ │  Local Storage │
                    ├────────────────┤ ├────────────────┤
                    │ 온통청년 API    │ │  JSON DB       │
                    │ (Youth Center) │ │  (Fallback)    │
                    └────────────────┘ └────────────────┘
```

## 🔄 데이터 흐름 (Data Flow)

```
사용자 요청 → Frontend → API Server → Service Layer → Data Fetcher
                                                          ↓
                                                    온통청년 API
                                                          ↓
                                                    Cache Check
                                                          ↓
                                                    Transform Data
                                                          ↓
Service Layer ← Data Processing ← API Response ← Clean & Format
      ↓
API Server → Frontend → 사용자 응답
```

## 🧩 핵심 컴포넌트 상세

### 1. Chatbot Server (Port 3000)
```
youthy-ai-chatbot
├── /api/chat ············· 채팅 메시지 처리
├── /api/popular-policies · 인기 정책 조회
└── /api/health ··········· 헬스체크
```

### 2. District API Server (Port 3001)
```
district-api-server
├── /api/district-policies ···· 구별 정책
│   └── /:district ············ 특정 구 정책
├── /api/special-top10 ········ 특수 TOP 10
├── /api/popular-keywords ····· 인기 키워드
├── /api/trending-policies ···· 트렌딩 정책
└── /api-docs ················· Swagger 문서
```

### 3. Data Processing Pipeline
```
API Request
    ↓
[Cache Check] → Hit → Return Cached Data
    ↓ Miss
[Fetch from 온통청년 API]
    ↓ Success              ↓ Fail
[Transform Data]      [Use Fallback DB]
    ↓                       ↓
[Clean Description]         ↓
    ↓                       ↓
[Format Dates]              ↓
    ↓                       ↓
[Cache Store]               ↓
    ↓                       ↓
[Return Response] ←─────────┘
```

## 📦 주요 모듈 구조

```
/home/user/webapp/
├── 🚀 Main Servers
│   ├── full-app.js ············· Chatbot Server (3000)
│   └── standalone-api-server.js · District API Server (3001)
│
├── 📡 API Integration
│   ├── real-policy-fetcher.js ··· 온통청년 API 호출
│   ├── chatbot-youth-api.js ····· 챗봇 API 서비스
│   └── district-policies-api.js · 구별 정책 API
│
├── 🔧 Services
│   ├── popular-policies-api.js ·· 인기 정책 서비스
│   └── swagger-routes.js ········ Swagger 문서화
│
├── 💾 Data
│   ├── district-real-policies.js · 구별 실제 정책 데이터
│   └── database/
│       └── youth_policies.json ··· Fallback 데이터
│
├── 🎨 Frontend
│   └── public/
│       ├── index.html ············ 메인 UI
│       ├── css/style.css ········· 스타일
│       └── js/app.js ············· 클라이언트 JS
│
└── ⚙️ Configuration
    ├── .env ····················· 환경변수 (API Key)
    ├── ecosystem.config.js ······ PM2 설정
    └── package.json ············· 의존성 관리
```

## 🚀 PM2 프로세스 관리

```
┌────┬──────────────────────┬─────────┬──────┬───────────┬──────────┐
│ id │ name                 │ version │ mode │ status    │ cpu      │
├────┼──────────────────────┼─────────┼──────┼───────────┼──────────┤
│ 0  │ youthy-ai-chatbot    │ 1.0.0   │ fork │ online    │ 0%       │
│ 1  │ district-api-server  │ 1.0.0   │ fork │ online    │ 0%       │
└────┴──────────────────────┴─────────┴──────┴───────────┴──────────┘
```

## 🔐 보안 및 성능 최적화

```
Security                          Performance
├── CORS 설정                     ├── 5분 캐싱
├── Helmet.js                     ├── 병렬 API 호출
├── 환경변수 관리                  ├── Compression
└── API Key 보호                  └── PM2 Cluster Mode (선택)
```

---

**버전**: 1.0.0
**최종 업데이트**: 2025-09-06
**상태**: Production Ready ✅